<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mentor Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Custom styles */
        .chat-container {
            height: 100vh;
            height: 100dvh;
        }
        @media (min-width: 768px) {
            .chat-container {
                height: 100vh;
                grid-template-columns: 320px 1fr;
            }
        }
        .messages-container {
            height: calc(100% - 140px);
        }
        .scrollbar-hidden::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hidden {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .typing-indicator span {
            animation: bounce 1.5s infinite ease-in-out;
        }
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes bounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-4px); }
        }
        .message-enter {
            opacity: 0;
            transform: translateY(10px);
        }
        .message-enter-active {
            opacity: 1;
            transform: translateY(0);
            transition: all 300ms ease-out;
        }
        .slide-in {
            animation: slideIn 300ms ease-out forwards;
        }
        .slide-out {
            animation: slideOut 300ms ease-out forwards;
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        @keyframes slideOut {
            from { transform: translateX(0); }
            to { transform: translateX(-100%); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">
    <div class="chat-container grid grid-rows-[auto_1fr_auto] md:grid-rows-1 md:grid-cols-[320px_1fr] overflow-hidden">
        <!-- Mobile Header -->
        <header class="bg-indigo-600 text-white p-4 flex items-center justify-between md:hidden">
            <button id="menuToggle" class="text-white">
                <i class="fas fa-bars text-xl"></i>
            </button>
            <h1 class="text-xl font-bold">Mentor Chat</h1>
            <div class="w-6"></div> <!-- Spacer for alignment -->
        </header>

        <!-- Sidebar - Chat List -->
        <aside id="sidebar" class="bg-white border-r border-gray-200 absolute md:relative inset-y-0 left-0 z-10 w-full md:w-auto md:block transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out">
            <div class="h-full flex flex-col">
                <!-- Sidebar Header -->
                <div class="p-4 border-b border-gray-200 flex items-center justify-between">
                    <h2 class="text-lg font-semibold">Chats</h2>
                    <button class="md:hidden text-gray-500 hover:text-gray-700" id="closeSidebar">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- Tabs -->
                <div class="flex border-b border-gray-200">
                    <button class="flex-1 py-3 font-medium text-indigo-600 border-b-2 border-indigo-600">
                        Messages <span class="bg-indigo-600 text-white text-xs px-2 py-0.5 rounded-full ml-1">4</span>
                    </button>
                    <button class="flex-1 py-3 font-medium text-gray-500 hover:text-gray-700">
                        Notifications
                    </button>
                </div>
                
                <!-- Chat List -->
                <div class="flex-1 overflow-y-auto scrollbar-hidden" id="chatList">
                    <!-- Chats will be populated here -->
                </div>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="bg-gray-50 flex flex-col h-full">
            <!-- Chat Header -->
            <div class="bg-white border-b border-gray-200 p-4 flex items-center">
                <button id="backButton" class="mr-3 text-gray-500 hover:text-gray-700 md:hidden">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="flex items-center flex-1">
                    <div class="relative">
                        <div id="currentChatAvatar" class="w-10 h-10 rounded-full bg-indigo-500 flex items-center justify-center text-white font-bold">AS</div>
                        <div id="currentChatStatus" class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-gray-400 rounded-full border-2 border-white"></div>
                    </div>
                    <div class="ml-3">
                        <h2 id="currentChatName" class="font-medium">Select a chat</h2>
                        <p id="currentChatStatusText" class="text-xs text-gray-500">Offline</p>
                    </div>
                </div>
                <div class="flex space-x-4">
                    <button class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-video"></i>
                    </button>
                    <button class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-phone"></i>
                    </button>
                </div>
            </div>
            
            <!-- Messages Area -->
            <div id="messagesContainer" class="messages-container overflow-y-auto p-4 scrollbar-hidden">
                <div id="noChatSelected" class="h-full flex flex-col items-center justify-center text-gray-400">
                    <i class="fas fa-comments text-4xl mb-4"></i>
                    <p class="text-lg">Select a chat to start messaging</p>
                </div>
                <!-- Messages will be populated here -->
            </div>
            
            <!-- Message Input -->
            <div id="messageInputContainer" class="bg-white border-t border-gray-200 p-4 hidden">
                <div class="flex items-center bg-gray-100 rounded-full px-4">
                    <button class="text-gray-500 hover:text-gray-700 mr-2">
                        <i class="far fa-smile"></i>
                    </button>
                    <input type="text" id="messageInput" placeholder="Type a message..." class="flex-1 bg-transparent border-none focus:ring-0 py-3">
                    <div class="flex items-center space-x-2 ml-2">
                        <button class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-paperclip"></i>
                        </button>
                        <button id="sendButton" class="w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center text-white">
                            <i class="fas fa-paper-plane text-sm"></i>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const menuToggle = document.getElementById('menuToggle');
            const closeSidebar = document.getElementById('closeSidebar');
            const sidebar = document.getElementById('sidebar');
            const backButton = document.getElementById('backButton');
            const chatList = document.getElementById('chatList');
            const messagesContainer = document.getElementById('messagesContainer');
            const noChatSelected = document.getElementById('noChatSelected');
            const messageInputContainer = document.getElementById('messageInputContainer');
            const messageInput = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const currentChatName = document.getElementById('currentChatName');
            const currentChatAvatar = document.getElementById('currentChatAvatar');
            const currentChatStatus = document.getElementById('currentChatStatus');
            const currentChatStatusText = document.getElementById('currentChatStatusText');

            // Sample Data
            const students = [
                {
                    id: 1,
                    name: "Anita Sutana",
                    avatar: "AS",
                    color: "indigo",
                    online: false,
                    lastSeen: "2 hours ago",
                    messages: [
                        { type: "received", text: "Hello Professor, I have a question about the assignment.", time: "10:30 AM" },
                        { type: "sent", text: "Hi Anita, what's your question?", time: "10:32 AM" },
                        { type: "received", text: "I'm not sure how to implement the blockchain functionality.", time: "10:35 AM" }
                    ]
                },
                {
                    id: 2,
                    name: "Arif Hossain",
                    avatar: "AH",
                    color: "blue",
                    online: true,
                    lastSeen: "Online",
                    messages: [
                        { type: "received", text: "Professor, when can we meet to discuss my research?", time: "9:15 AM" }
                    ]
                },
                {
                    id: 3,
                    name: "Nobel Hasan",
                    avatar: "NH",
                    color: "green",
                    online: false,
                    lastSeen: "Yesterday",
                    messages: [
                        { type: "sent", text: "Did you review the materials I sent?", time: "3:45 PM" },
                        { type: "received", text: "Yes, they were very helpful!", time: "4:30 PM" }
                    ]
                },
                {
                    id: 4,
                    name: "Robert Hasan",
                    avatar: "RH",
                    color: "purple",
                    online: true,
                    lastSeen: "Online",
                    messages: [
                        { type: "received", text: "Good morning! About the internship opportunity...", time: "8:30 AM" }
                    ]
                }
            ];

            // State
            let activeChatId = null;
            let typingIntervals = {};

            // Toggle Sidebar on Mobile
            menuToggle.addEventListener('click', () => {
                sidebar.classList.remove('-translate-x-full');
            });

            closeSidebar.addEventListener('click', () => {
                sidebar.classList.add('-translate-x-full');
            });

            backButton.addEventListener('click', () => {
                activeChatId = null;
                noChatSelected.style.display = 'flex';
                messageInputContainer.style.display = 'none';
                updateChatHeader();
            });

            // Render Chat List
            function renderChatList() {
                chatList.innerHTML = '';
                students.forEach(student => {
                    const lastMessage = student.messages[student.messages.length - 1];
                    const unreadCount = student.messages.filter(msg => msg.type === 'received' && !msg.read).length;

                    const chatItem = document.createElement('div');
                    chatItem.className = 'p-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer';
                    chatItem.dataset.id = student.id;
                    chatItem.innerHTML = `
                        <div class="flex items-center">
                            <div class="relative">
                                <div class="w-10 h-10 rounded-full bg-${student.color}-500 flex items-center justify-center text-white font-bold">${student.avatar}</div>
                                <div class="absolute bottom-0 right-0 w-2.5 h-2.5 ${student.online ? 'bg-green-500' : 'bg-gray-400'} rounded-full border-2 border-white"></div>
                            </div>
                            <div class="ml-3 flex-1">
                                <div class="flex justify-between items-center">
                                    <h3 class="font-medium">${student.name}</h3>
                                    <span class="text-xs text-gray-500">${lastMessage.time}</span>
                                </div>
                                <p class="text-sm text-gray-500 truncate">${lastMessage.text}</p>
                            </div>
                            ${unreadCount > 0 ? `<span class="ml-2 w-5 h-5 bg-indigo-600 rounded-full flex items-center justify-center text-white text-xs">${unreadCount}</span>` : ''}
                        </div>
                    `;
                    chatList.appendChild(chatItem);
                });

                // Add click handlers
                document.querySelectorAll('#chatList > div').forEach(item => {
                    item.addEventListener('click', function() {
                        const studentId = parseInt(this.dataset.id);
                        loadChat(studentId);
                        if (window.innerWidth < 768) {
                            sidebar.classList.add('-translate-x-full');
                        }
                    });
                });
            }

            // Load Chat
            function loadChat(studentId) {
                activeChatId = studentId;
                const student = students.find(s => s.id === studentId);
                
                // Update header
                currentChatName.textContent = student.name;
                currentChatAvatar.textContent = student.avatar;
                currentChatAvatar.className = `w-10 h-10 rounded-full bg-${student.color}-500 flex items-center justify-center text-white font-bold`;
                currentChatStatus.className = `absolute bottom-0 right-0 w-2.5 h-2.5 ${student.online ? 'bg-green-500' : 'bg-gray-400'} rounded-full border-2 border-white`;
                currentChatStatusText.textContent = student.online ? 'Online' : `Last seen ${student.lastSeen}`;
                currentChatStatusText.className = `text-xs ${student.online ? 'text-green-500' : 'text-gray-500'}`;
                
                // Show messages
                noChatSelected.style.display = 'none';
                messageInputContainer.style.display = 'block';
                
                // Render messages
                messagesContainer.innerHTML = '';
                student.messages.forEach(message => {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `flex mb-4 ${message.type === 'sent' ? 'justify-end' : 'justify-start'}`;
                    
                    messageDiv.innerHTML = `
                        <div class="max-w-xs md:max-w-md rounded-lg px-4 py-2 ${message.type === 'sent' ? 'bg-indigo-600 text-white' : 'bg-white border border-gray-200'}">
                            <p>${message.text}</p>
                            <p class="text-xs mt-1 ${message.type === 'sent' ? 'text-indigo-100' : 'text-gray-500'}">${message.time}</p>
                        </div>
                    `;
                    messagesContainer.appendChild(messageDiv);
                });
                
                // Scroll to bottom
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                // Mark messages as read
                student.messages.forEach(msg => msg.read = true);
                
                // Update chat list
                renderChatList();
            }

            // Send Message
            function sendMessage() {
                if (!activeChatId || !messageInput.value.trim()) return;
                
                const student = students.find(s => s.id === activeChatId);
                const messageText = messageInput.value.trim();
                
                // Add sent message
                student.messages.push({
                    type: "sent",
                    text: messageText,
                    time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                });
                
                // Clear input
                messageInput.value = '';
                
                // Reload chat
                loadChat(activeChatId);
                
                // Simulate reply if online
                if (student.online) {
                    setTimeout(() => {
                        if (activeChatId === student.id) { // Check if still same chat
                            // Show typing indicator
                            student.messages.push({
                                type: "received",
                                text: "...",
                                time: "typing",
                                isTyping: true
                            });
                            loadChat(activeChatId);
                            
                            // Send actual reply after delay
                            setTimeout(() => {
                                // Remove typing indicator
                                student.messages = student.messages.filter(m => !m.isTyping);
                                
                                // Add reply
                                const replies = [
                                    "Thanks for your message!",
                                    "I'll get back to you soon.",
                                    "That's helpful, thanks!",
                                    "Can we discuss this tomorrow?",
                                    "I appreciate your quick response."
                                ];
                                const reply = replies[Math.floor(Math.random() * replies.length)];
                                
                                student.messages.push({
                                    type: "received",
                                    text: reply,
                                    time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                                });
                                
                                loadChat(activeChatId);
                            }, 1500 + Math.random() * 1500);
                        }
                    }, 500 + Math.random() * 1000);
                }
            }

            // Event Listeners
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
            sendButton.addEventListener('click', sendMessage);

            // Handle window resize
            function handleResize() {
                if (window.innerWidth >= 768) {
                    // Desktop - ensure sidebar is visible
                    sidebar.classList.remove('-translate-x-full');
                }
            }

            window.addEventListener('resize', handleResize);

            // Initialize
            renderChatList();
            handleResize();

            // Simulate online status changes
            setInterval(() => {
                students.forEach(student => {
                    if (Math.random() > 0.7) { // 30% chance to change status
                        student.online = !student.online;
                        student.lastSeen = student.online ? 'Online' : `${Math.floor(Math.random() * 24)} hours ago`;
                        
                        if (activeChatId === student.id) {
                            updateChatHeader();
                        }
                        renderChatList();
                    }
                });
            }, 10000);

            function updateChatHeader() {
                if (!activeChatId) {
                    currentChatName.textContent = "Select a chat";
                    currentChatAvatar.textContent = "";
                    currentChatStatus.className = "absolute bottom-0 right-0 w-2.5 h-2.5 bg-gray-400 rounded-full border-2 border-white";
                    currentChatStatusText.textContent = "Offline";
                    return;
                }
                
                const student = students.find(s => s.id === activeChatId);
                currentChatName.textContent = student.name;
                currentChatAvatar.textContent = student.avatar;
                currentChatStatus.className = `absolute bottom-0 right-0 w-2.5 h-2.5 ${student.online ? 'bg-green-500' : 'bg-gray-400'} rounded-full border-2 border-white`;
                currentChatStatusText.textContent = student.online ? 'Online' : `Last seen ${student.lastSeen}`;
            }
        });
    </script>
</body>
</html>